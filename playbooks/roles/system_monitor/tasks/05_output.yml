# Steps to Creat Markdown
---

- name: Create daily Markdown report file with headers
  lineinfile:
    path: "./output/{{ ansible_date_time.date }}_report.md"
    line: |
      | SUNUCULAR | CPU | RAM | DISK | UPTIME |
      |-----------|-----|-----|------|--------|
    create: yes
  delegate_to: localhost
  run_once: true

- name: Collect system information for each server
  shell: |
    printf "| %s | %s | %s | %s | %s |\n" "{{ inventory_hostname }}" "$(mpstat | grep all | awk '{print $3+$5}')%" "$(free | grep Mem | awk '{print $3/$2 * 100.0}')%" "$(df -h | grep /dev/sda1 | awk '{print $5}')" "$(uptime -p | cut -d ' ' -f 2-)"
  register: system_info
  changed_when: false

- name: Append system information to the Markdown file
  lineinfile:
    path: "./output/{{ ansible_date_time.date }}_report.md"
    line: "{{ system_info.stdout }}"
  delegate_to: localhost